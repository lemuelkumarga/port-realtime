<html>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<body>
  <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script type="text/javascript">
Highcharts.stockChart('container', {
    chart: {
        type: 'spline'
    },
    
    title: {
        text: 'VTI vs VXUS Performance Comparisons'
    },
    
    data: {
        csvURL: 'https://j5ah51nweg.execute-api.ca-central-1.amazonaws.com/api/returns',
        enablePolling: true,
        dataRefreshRate: 5
    },
 
    exporting: {
        enabled: false
    },
    
    navigator: {
        enabled: false
    },
    
    rangeSelector: {
        inputEnabled: false,
        buttonTheme: {
            visibility: 'hidden'
        },
        labelStyle: {
            visibility: 'hidden'
        }
    },

    scrollbar: {
        enabled: false
    }, 
  
    xAxis: {
        crosshair: true,
        tickPositioner: function () {

			var positions = []

            // Find UTC timezone offset to New York for DST adjustment
            var cur_d = new Date()
            var utc_d = new Date(cur_d.toLocaleString('en-US', { timeZone: 'UTC' }))
            var ny_d = new Date(cur_d.toLocaleString('en-US', { timeZone: 'America/New_York' }))
            var tz_offset = (ny_d.getTime() - utc_d.getTime())/1000

            for (var tick = Math.ceil(this.dataMin / 60000) * 60000; 
            	 tick <= this.dataMax - 30000; tick += 60000) {
            	
            	var d=new Date(0);
            	// Default tick value is in local timezone
            	// Convert the local timezone to utc then 
            	// move it into NY timezone
            	d.setUTCSeconds(tick/1000 + d.getTimezoneOffset()*60 + tz_offset);

            	// Skip Non-Trading Hours
            	// If we are on Friday after 4:00pm, skip for two days
            	if (d.getUTCDay() == 5 && d.getUTCHours() >= 16) {
            		tick += 2 * 24 * 3600 * 1000
            	}
            	// If we are after 4pm, skip until 9:30am
            	if (d.getUTCHours() >= 16) {
            		tick += 17.5 * 3600 * 1000 
            		continue
            	}	

            	positions.push(tick);
            }

            positions.push(this.dataMax)

            return positions
        },
        labels: {
            formatter: function() {
                var d = new Date(0);
                d.setUTCSeconds(this.value/1000 + d.getTimezoneOffset()*60);

                var hours = d.getHours();
                if (hours < 10) hours = '0' + hours;

                var minutes = d.getMinutes();
                if (minutes < 10) minutes = '0' + minutes;

                var seconds = d.getSeconds();
                if (seconds == 0) seconds = '';
                else if (seconds < 10) seconds = '0' + seconds;
                return hours + ':' + minutes + (seconds == '' ? '' : ':' + seconds)
            }
        }
    },
    
    yAxis: {
        opposite: false,
        title: {
            text: "Daily Returns (bps: 1/100 percent)"
        },
        labels: {
            formatter: function () {
                var label = this.axis.defaultLabelFormatter.call(this);
                return Highcharts.numberFormat(this.value * 10000.,0);
            }
        },
    },
    
    legend: {
        align: 'right',
        enabled: true
    },
    
    /* https://stackoverflow.com/questions/36673214/show-value-of-last-point-as-label-or-tooltip-on-highcharts-stock-chart */
    plotOptions: {
        series: {
            dataLabels: {
                enabled: true,
                padding: 5,
                align: 'right',
                formatter: function(){
                    var isLast = false;
                    if (this.series.data.length == 0) return '';
                    if(this.point.x == this.series.data[this.series.data.length - 1].x) isLast = true;
                    if (isLast) {
                        return '<span style="color:' + this.series.color + '">' + (this.y * 10000.).toFixed(2) + ' bps</span>';
                    }
                }
            }
        }
    },
    
    tooltip: {
        pointFormatter: function() {
             return this.series.name + ': ' +
                    (this.y * 10000.).toFixed(2) + ' bps';
        },
        shared: true
    },

});
</script>
  </body>
</html>
